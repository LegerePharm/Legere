<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="0">
        <function name="write" model="ir.model.data">
            <function name="search" model="ir.model.data">
                <value
                  eval="[('module', '=', 'stock'), ('name', '=', 'mail_template_data_delivery_confirmation')]"
                  />
            </function>
            <value eval="{'noupdate': False}" />
        </function>
        <record id="stock.mail_template_data_delivery_confirmation" model="mail.template">
            <field name="body_html" type="html">
                <div style="margin: 0px; padding: 0px;">
                    <p style="margin: 0px; padding: 0px; font-size: 13px;">
                    Hello <t t-out="object.partner_id.name or ''"/>,
                        <br/>
                        <br/>
                    We are glad to inform you that your order has been shipped.
                        <br/>
                        <br/>

                        <div style="margin: 0px; padding: 0px;">
                            <t t-if="object.carrier_id.delivery_type != 'easypost'">
                                <t t-if="hasattr(object, 'carrier_tracking_ref') and object.carrier_tracking_ref">
                                    Your tracking reference is
                                    <strong>
                                    <t t-if="object.carrier_tracking_url">
                                        <t t-set="multiple_carrier_tracking" t-value="object.get_multiple_carrier_tracking()"/>
                                        <t t-if="multiple_carrier_tracking">
                                            <t t-foreach="multiple_carrier_tracking" t-as="line">
                                                <br/><a t-att-href="line[1]" target="_blank" t-out="line[0] or ''"></a>
                                            </t>
                                        </t>
                                        <t t-else="">
                                            <a t-attf-href="{{ object.carrier_tracking_url }}" target="_blank" t-out="object.carrier_tracking_ref or ''"></a>.
                                        </t>
                                    </t>
                                    <t t-else="">
                                        <t t-out="object.carrier_tracking_ref or ''"></t>.
                                    </t>
                                    </strong>
                                    <br/><br/>
                                </t>
                            </t>

                            <t t-set="tracking_package" t-value="False"/>
                            <t t-if="object.carrier_id.delivery_type == 'easypost'">
                                <p style="margin: 0px; padding: 0px; font-size: 13px;"/>
                                <t t-foreach="object.ep_shipment_ids" t-as="tracking">
                                    <t t-if="not tracking.is_return_shipment">
                                        <table width="100%" style="color: #454748; font-size: 12px; border-collapse: collapse;">
                                        <tr>
                                            <td style="color:#2c2c2c;line-height:20px;font-weight:300;margin:0;clear:both;font-size:13px" > 
                                                    Tracking #:
                                                <font style="font-size:17px;color:#565656"><t t-out="tracking.name or ''"/></font>
                                                <br />
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="color:#2c2c2c;line-height:20px;font-weight:300;margin:0 auto;clear:both;">
                                                <t t-if="object.carrier_id.name and tracking.name and tracking.get_tracking_url()">
                                                    <a style="width:300px;margin:20px;background-color:#007fb8;text-align:center;padding:5px 0;border-radius:2px;display:block;color:#fff;font-size:13px" t-attf-href="{{ tracking.get_tracking_url() }}" target="_blank"><span style="color:#ffffff;font-size:13px;background-color:#007fb8">TRACK YOUR SHIPMENT</span></a>
                                                </t>
                                            </td>
                                        </tr>
                                        </table>

                                        <t t-if="tracking.package_id">
                                            <table width="100%" style="color: #454748; font-size: 12px; border-collapse: collapse;">
                                            <tr style="border-bottom: 2px solid #dee2e6;">
                                                <td width="30%"><strong>Products</strong></td>
                                                <td width="30%"></td>
                                                <td width="40%"><strong>Qty shipped</strong></td>
                                            </tr>
                                            </table>
                                            <t t-if="object.get_product_lines()">
                                            <t t-set="result_package_id" t-value="False"/>
                                            <t t-foreach="object.get_product_lines().filtered(lambda l: l.result_package_id and l.result_package_id == tracking.package_id)" t-as="line">
                                            <t t-set="tracking_package" t-value="True"/>
                                            <table width="100%" style="color: #454748; font-size: 12px; border-collapse: collapse;">
                                                <t t-if="line.result_package_id and line.result_package_id != result_package_id">
                                                    <tr style="${loop.cycle('background-color: #f2f2f2', 'background-color: #ffffff')}">
                                                        <td colspan="3">
                                                            <t t-set="result_package_id" t-value="line.result_package_id"/>
                                                            <strong t-out="line.result_package_id.name or ''"></strong>
                                                        </td>
                                                    </tr>
                                                </t>
                                                <tr style="${loop.cycle('background-color: #f2f2f2', 'background-color: #ffffff')}">
                                                    <td width="30%" align="left"><t t-out="line.product_id.name or ''"/></td>
                                                    <td style="padding: 10px; width:150px;">
                                                        <img t-attf-src="/web/image/product.product/{{ line.product_id.id }}/image_128" style="width: 100px; height: 100px; object-fit: contain;" alt="Product image"></img>
                                                    </td>
                                                    <td width="40%"><t t-out="line.qty_done"/></td>
                                                </tr>
                                            </table>
                                            </t>
                                            </t>
                                        </t>
                                    </t>
                                </t>
                            </t>

                            <t t-if="not tracking_package">
                                <table width="100%" style="color: #454748; font-size: 12px; border-collapse: collapse;">
                                    <tr style="border-bottom: 2px solid #dee2e6;">
                                        <td width="30%"><strong>Products</strong></td>
                                        <td width="30%"></td>
                                        <td width="40%"><strong>Qty shipped</strong></td>
                                    </tr>
                                </table>
                                <t t-if="object.get_product_lines()">
                                <t t-set="result_package_id" t-value="False"/>
                                <t t-foreach="object.get_product_lines()" t-as="line">
                                <table width="100%" style="color: #454748; font-size: 12px; border-collapse: collapse;">
                                    <t t-if="line.result_package_id and line.result_package_id != result_package_id">
                                        <tr style="${loop.cycle('background-color: #f2f2f2', 'background-color: #ffffff')}">
                                            <td colspan="3">
                                                <t t-set="result_package_id" t-value="line.result_package_id"/>
                                                <strong t-out="line.result_package_id.name or ''"></strong>
                                            </td>
                                        </tr>
                                    </t>
                                    <tr style="${loop.cycle('background-color: #f2f2f2', 'background-color: #ffffff')}">
                                        <td width="30%" align="left"><t t-out="line.product_id.name or ''"/></td>
                                        <td style="padding: 10px; width:150px;">
                                            <img t-attf-src="/web/image/product.product/{{ line.product_id.id }}/image_128" style="width: 100px; height: 100px; object-fit: contain;" alt="Product image"></img>
                                        </td>
                                        <td width="40%"><t t-out="line.qty_done"/></td>
                                    </tr>
                                </table>
                                </t>
                                </t>
                            </t>
                        </div>
                        <br/>
                        <br/>
                    Please find your delivery order attached for more details.<br/><br/>
                    Thank you,
                        <br/>
                        <t t-if="user and user.signature">
                        <br />
                        <t t-out="user.signature or ''"></t>
                    </t>
                    </p>
                </div>
            </field>
        </record>

        <function name="write" model="ir.model.data">
            <function name="search" model="ir.model.data">
                <value
                  eval="[('module', '=', 'stock'), ('name', '=', 'mail_template_data_delivery_confirmation')]"
                  />
            </function>
            <value eval="{'noupdate': True}" />
        </function>
    </data>

    <data noupdate="1">
        <record id="email_template_shipment_out_for_delivery" model="mail.template">
            <field name="name">Shipment: Out for Delivery</field>
            <field name="model_id" ref="stride_delivery.model_easypost_shipment"/>
            <field name="email_from">{{ (object.picking_id.user_id.email_formatted or user.email_formatted) }}</field>
            <field name="partner_to">{{ object.picking_id.partner_id.id }}</field>
            <field name="subject">Shipment: Out for Delivery</field>
            <field name="auto_delete" eval="True"/>
            <field name="lang">{{ object.picking_id.partner_id.lang }}</field>
            <field name="body_html" type="html">
                <div style="margin: 0px; padding: 0px;">
                    <p style="margin: 0px; padding: 0px; font-size: 13px;">
                    Hello <t t-out="object.picking_id.partner_id.name or ''"/>,
                        <br/>
                        <br/>
                    We are glad to inform you that your Shipment <strong><a t-attf-href="{{ object.get_tracking_url() }}" target="_blank"><span t-out="object.name or ''"/></a></strong> is  Out for Delivery<t t-if="object.picking_id.sale_id"> for Order <strong><a t-attf-href="{{ object.picking_id.sale_id.get_order_tracking_url() }}" target="_blank"><span t-out="object.picking_id.sale_id.name or ''"/></a></strong></t>.
                        <br/>
                        <br/>

                        <div style="margin: 0px; padding: 0px;">
                            <table width="100%" style="color: #454748; font-size: 12px; border-collapse: collapse;">
                                <tr style="border-bottom: 2px solid #dee2e6;">
                                    <td width="20%"><strong>Products</strong></td>
                                    <td width="20%"></td>
                                    <td width="60%"><strong>Qty shipped</strong></td>
                                </tr>
                            </table>
                            <t t-if="object.picking_id.get_product_lines()">
                            <t t-set="result_package_id" t-value="False"/>
                            <t t-if="object.package_id">
                                <t t-set="picking_lines" t-value="object.picking_id.get_product_lines().filtered(lambda l: l.result_package_id and l.result_package_id == object.package_id)"/>
                            </t>
                            <t t-else="">
                                <t t-set="picking_lines" t-value="object.picking_id.get_product_lines()"/>
                            </t>
                            <t t-foreach="picking_lines" t-as="line">
                            <table width="100%" style="color: #454748; font-size: 12px; border-collapse: collapse;">
                                <t t-if="line.result_package_id and line.result_package_id != result_package_id">
                                    <tr style="${loop.cycle('background-color: #f2f2f2', 'background-color: #ffffff')}">
                                        <td colspan="3">
                                            <t t-set="result_package_id" t-value="line.result_package_id"/>
                                            <strong t-out="line.result_package_id.name or ''"></strong>
                                        </td>
                                    </tr>
                                </t>
                                <tr style="${loop.cycle('background-color: #f2f2f2', 'background-color: #ffffff')}">
                                    <td width="20%" align="left"><t t-out="line.product_id.name or ''"/></td>
                                    <td style="padding: 10px; width:150px;">
                                        <img t-attf-src="/web/image/product.product/{{ line.product_id.id }}/image_128" style="width: 100px; height: 100px; object-fit: contain;" alt="Product image"></img>
                                    </td>
                                    <td width="60%"><t t-out="line.qty_done"/></td>
                                </tr>
                            </table>
                            </t>
                            </t>
                        </div>
                        <br/>
                        <br/>             
                    Thank you,
                        <br/>
                    </p>
                </div>
            </field>
        </record>

        <record id="email_template_shipment_delivered" model="mail.template">
            <field name="name">Shipment: Delivered</field>
            <field name="model_id" ref="stride_delivery.model_easypost_shipment"/>
            <field name="email_from">{{ (object.picking_id.user_id.email_formatted or user.email_formatted) }}</field>
            <field name="partner_to">{{ object.picking_id.partner_id.id }}</field>
            <field name="lang">{{ object.picking_id.partner_id.lang }}</field>
            <field name="subject">Shipment: Delivered</field>
            <field name="auto_delete" eval="True"/>
            <field name="body_html" type="html">
                <div style="margin: 0px; padding: 0px;">
                    <p style="margin: 0px; padding: 0px; font-size: 13px;">
                        Hello <t t-out="object.picking_id.partner_id.name or ''"/>
                        <br/>
                        <br/>
                        We are glad to inform you that your Shipment <strong><a t-attf-href="{{ object.get_tracking_url() }}" target="_blank"><span t-out="object.name or ''"/></a></strong> has been shipped<t t-if="object.picking_id.sale_id"> for Order <strong><a t-attf-href="{{ object.picking_id.sale_id.get_order_tracking_url() }}" target="_blank"><span t-out="object.picking_id.sale_id.name or ''"/></a></strong></t>.
                        <br/>
                        <br/>
                        <div style="margin: 0px; padding: 0px;">
                            <table width="100%" style="color: #454748; font-size: 12px; border-collapse: collapse;">
                                <tr style="border-bottom: 2px solid #dee2e6;">
                                    <td width="20%"><strong>Products</strong></td>
                                    <td width="20%"></td>
                                    <td width="60%"><strong>Qty shipped</strong></td>
                                </tr>
                            </table>
                            <t t-if="object.picking_id.get_product_lines()">
                            <t t-set="result_package_id" t-value="False"/>
                            <t t-if="object.package_id">
                                <t t-set="picking_lines" t-value="object.picking_id.get_product_lines().filtered(lambda l: l.result_package_id and l.result_package_id == object.package_id)"/>
                            </t>
                            <t t-else="">
                                <t t-set="picking_lines" t-value="object.picking_id.get_product_lines()"/>
                            </t>
                            <t t-foreach="picking_lines" t-as="line">
                            <table width="100%" style="color: #454748; font-size: 12px; border-collapse: collapse;">
                                <t t-if="line.result_package_id and line.result_package_id != result_package_id">
                                    <tr style="${loop.cycle('background-color: #f2f2f2', 'background-color: #ffffff')}">
                                        <td colspan="3">
                                            <t t-set="result_package_id" t-value="line.result_package_id"/>
                                            <strong t-out="line.result_package_id.name or ''"></strong>
                                        </td>
                                    </tr>
                                </t>
                                <tr style="${loop.cycle('background-color: #f2f2f2', 'background-color: #ffffff')}">
                                    <td width="20%" align="left"><t t-out="line.product_id.name or ''"/></td>
                                    <td style="padding: 10px; width:150px;">
                                        <img t-attf-src="/web/image/product.product/{{ line.product_id.id }}/image_128" style="width: 100px; height: 100px; object-fit: contain;" alt="Product image"></img>
                                    </td>
                                    <td width="60%"><t t-out="line.qty_done"/></td>
                                </tr>
                            </table>
                            </t>
                            </t>
                        </div>
                        <br/>
                        <br/>

                        Thank you,
                        <br/>
                    </p>
                </div>
            </field>
        </record>

    </data>
</odoo>